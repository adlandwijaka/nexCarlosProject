<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ask Gemini from Sheet</title>
  <script defer>
    const SHEET_ID = "1ow2qXXCDc_TihdS3iSPgZzS6YB5Omi3NwOfENNigfUs";
    const SHEET_NAME = "Form responses 1";
    const FORM_URL = "https://docs.google.com/forms/d/e/16B5ZKtZ809W-xQWMwgliQQ7Po12o3hv09NFx23WzO80/viewform";

    function loadSheetData() {
      const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(SHEET_NAME)}`;
      fetch(CSV_URL)
        .then(res => res.text())
        .then(csv => {
          const rows = csv.trim().split("\n");
          const headers = rows[0].split(",");

          const tableBody = document.getElementById("history-body");
          tableBody.innerHTML = "";

          for (let i = 1; i < rows.length; i++) {
            const cols = rows[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(c => c.replace(/^"|"$/g, ""));
            if (cols.length < 5) continue;

            const [timestamp, question, from, to, ...rest] = cols;
            const answer = rest.pop(); // kolom terakhir
            const tr = document.createElement("tr");
            [timestamp, question, from, to, answer].forEach(text => {
              const td = document.createElement("td");
              td.textContent = text;
              td.style.borderTop = "1px solid #ccc";
              td.style.padding = "8px";
              tr.appendChild(td);
            });
            tableBody.appendChild(tr);
          }
        });
    }

    window.addEventListener("DOMContentLoaded", loadSheetData);
  </script>
</head>
<body style="font-family: sans-serif; padding: 20px;">

  <h2>Ask Anything to Gemini (Based on Dashboard)</h2>

  <iframe src="${FORM_URL}?embedded=true" width="100%" height="500" frameborder="0" marginheight="0" marginwidth="0">Loadingâ€¦</iframe>

  <h3 style="margin-top: 40px;">ðŸ“Š Gemini Response History</h3>
  <table width="100%" cellspacing="0" cellpadding="0" style="border-collapse: collapse; width: 100%;">
    <thead style="background: #f5f5f5;">
      <tr>
        <th style="text-align: left; padding: 8px;">Timestamp</th>
        <th style="text-align: left; padding: 8px;">Question</th>
        <th style="text-align: left; padding: 8px;">Period From</th>
        <th style="text-align: left; padding: 8px;">Period To</th>
        <th style="text-align: left; padding: 8px;">Answer</th>
      </tr>
    </thead>
    <tbody id="history-body"></tbody>
  </table>

</body>
</html>
